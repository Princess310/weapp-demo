<import src="../../../templates/contentParse.wxml"/>

<template name="feed-detail-moment">
	<navigator url="../detail/index?id={{id}}">
		<view class="fedd-detail-item">
			<view class="feed-detail-left">
				<navigator url="../../yaoyue/detail/index?id={{uid}}" class="user-icon-wrapper">
					<image mode="aspectFill" class="user-icon" src="{{avatar}}"/>
					<view wx:if="{{verify_status == 2}}" class="vip">V</view>
				</navigator>
			</view>
			<view class="feed-detail-right">
				<view class="header">
					<view class="wrapper">
						<text class="user-name">{{nickname}}</text>
						<image wx:if="{{mobile && mobile !== ''}}" src="../../../images/dianhua_icon.png" mode="aspectFit" data-tel="{{mobile}}" catchtap="handleCall"/>
					</view>
					<view class="wrapper">
						<text wx:if="{{reward_as == 1}}" class="label supply">供</text>
						<text wx:if="{{reward_as == 2}}" class="label">求</text>
						<text wx:if="{{reward_amount > 0}}" class="money">{{reward_amount}}元</text>
						<image class="todo-btn" mode="aspectFill" src="../../../images/icon_menu.png" data-id="{{id}}" data-uid="{{uid}}" catchtap="handleTodo"></image>
					</view>
				</view>
				<view class="sub-info">
					<text>{{company}}</text>
					<text>{{tag_identity_name}}</text>
				</view>
				<view class="time">
					<text>{{created_at}}</text>
				</view>
				<view class="user-status-wrapper">
					<view class="user-status-content">
						<view class="words">
							<block wx:for-items="{{nodes}}" wx:key="{{index}}">
								<template is="content-parse-tmpl" data="{{...item, index: index}}" />
							</block>
						</view>
						<view class="pictures {{(pictures.length === 2) ? 'normal' : (pictures.length === 1 ? 'big' : '')}}">
							<block wx:for="{{pictures}}" wx:key="unique">
								<image mode="aspectFill" class="pic" src="{{item}}" data-src="{{item}}" data-pid="{{id}}" catchtap="handleViewImage"></image>
							</block>
						</view>
					</view>
					<view class="user-status-time">
						<view class="time">{{hits}}人看过</view>
					</view>
				</view>
			</view>
		</view>
		<view class="feed-status-info">
			<view class="user-status-operaters">
				<view class="operater-item share-btn">
					<image  wx:if="{{is_share === 0}}" mode="aspectFill" src="../../../images/icon_share.png"></image>
					<image wx:if="{{is_share > 0}}" mode="aspectFill" src="../../../images/icon_share_active.png"></image>
					<text class="count">{{share_count}}</text>
				</view>
				<view class="operater-item comment-btn">
					<image mode="aspectFill" src="../../../images/comment_icon.png"></image>
					<text class="count">{{comment_count}}</text>
				</view>
				<view class="operater-item agree-btn" data-id="{{id}}" data-uid="{{uid}}" catchtap="handleAgree">
					<image wx:if="{{is_like === 0}}" mode="aspectFill" src="../../../images/icon_zan.png"></image>
					<image wx:if="{{is_like > 0}}" mode="aspectFill" src="../../../images/icon_zan_active.png"></image>
					<text class="count">{{like_count}}</text>
				</view>
			</view>
		</view>
	</navigator>
</template>

<view class="page__bd">
    <view class="weui-tab">
        <view class="weui-navbar">
            <block wx:for-items="{{props.moment.roles}}" wx:key="{{index}}">
                <view id="{{item.id}}" class="weui-navbar__item {{activeIndex == index ? 'weui-bar__item_on' : ''}}" bindtap="tabClick">
                    <view class="weui-navbar__title">{{item.name}}</view>
                </view>
            </block>
            <view class="weui-navbar__slider" style="left: {{state.sliderLeft}}rpx; transform: translateX({{state.sliderOffset}}px); -webkit-transform: translateX({{state.sliderOffset}}px);"></view>
        </view>
        <view class="weui-tab__panel">
            <view class="weui-tab__content" hidden="{{activeIndex != 0}}"></view>
            <view class="weui-tab__content" hidden="{{activeIndex != 1}}"></view>
            <view class="weui-tab__content" hidden="{{activeIndex != 2}}"></view>
        </view>
    </view>
</view>

<navigator class="ali-search-container" url="../../common/searchPanel/index?action=moment">
	<view class="weui-search-bar">
		<view class="weui-search-bar__form">
			<view class="weui-search-bar__box">
				<input type="text" class="weui-search-bar__input" placeholder="搜索动态" />
			</view>
			<label class="weui-search-bar__label">
				<icon class="weui-icon-search" type="search" size="14"></icon>
				<view class="weui-search-bar__text">搜索动态</view>
			</label>
		</view>
	</view>
</navigator>

<view class="dashboard">
	<block wx:if="{{props.moment.list.length > 0}}">
		<block wx:for="{{props.moment.list}}"  wx:key="id">
			<template is="feed-detail-moment" data="{{...item, index: index}}" />
		</block>
	</block>
	<block wx:else>
		<view class="no-data">
			<text>没有动态？点击发布按钮发布动态吧</text>
		</view>
	</block>
</view>
<navigator class="publish-wrapper" url="../publish/index">
	<image src="../../../images/business_pubsh.png" mode="scaleToFill" />
</navigator>
