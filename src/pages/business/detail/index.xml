<import src="../../../templates/contentParse.wxml"/>

<template name="user-comment-item">
	<view class="feed-comment-panel comment-title">
		<view class="feed-comment-left">
			<navigator url="../../yaoyue/detail/index?id={{created_by}}" class="user-icon-wrapper">
				<image mode="aspectFill" class="user-icon" src="{{avatar}}"/>
				<view wx:if="{{verify_status == 2}}" class="vip">V</view>
			</navigator>
		</view>
		<view class="feed-comment-right">
			<view class="header">
				<view class="wrapper">
					<text class="user-name">{{nickname}}</text>
					<text class="company">{{company}}</text>
					<text class="role">{{position}}</text>
				</view>
			</view>
			<view class="sub-info">
				<text>{{tag_identity_name}}</text>
			</view>
		</view>
	</view>
</template>


<scroll-view>
	<view class="fedd-detail-item">
		<view class="feed-detail-left">
			<navigator class="user-icon-wrapper" url="../../yaoyue/detail/index?id={{props.moment.detail.uid}}">
				<image mode="aspectFill" class="user-icon" src="{{props.moment.detail.avatar}}"/>
				<view wx:if="{{props.moment.detail.verify_status == 2}}" class="vip">V</view>
			</navigator>
		</view>
		<view class="feed-detail-right">
			<view class="header">
				<view class="wrapper">
					<text class="user-name">{{props.moment.detail.nickname}}</text>
				</view>
				<view class="wrapper">
					<text wx:if="{{props.moment.detail.reward_as == 1}}" class="label supply">供</text>
					<text wx:if="{{props.moment.detail.reward_as == 2}}" class="label">求</text>
					<text wx:if="{{props.moment.detail.reward_amount > 0}}" class="money">{{props.moment.detail.reward_amount}}元</text>
				</view>
			</view>
			<view class="sub-info">
				<text>{{props.moment.detail.company}}</text>
				<text>{{props.moment.detail.tag_identity_name}}</text>
			</view>
			<view class="time">
				<text>{{props.moment.detail.created_at}}</text>
			</view>
			<view class="user-status-wrapper">
				<view class="user-status-content">
					<view class="words">
						<block wx:for-items="{{props.moment.detail.nodes}}" wx:key="{{index}}">
							<template is="content-parse-tmpl" data="{{...item, index: index}}" />
						</block>
					</view>
					<view class="pictures {{(props.moment.detail.pictures.length === 2) ? 'normal' : (props.moment.detail.pictures.length === 1 ? 'big' : '')}}">
						<block wx:for="{{props.moment.detail.pictures}}" wx:key="unique">
							<image mode="aspectFill" class="pic" src="{{item}}" data-src="{{item}}" data-pid="{{id}}" catchtap="handleViewImage"></image>
						</block>
					</view>
				</view>
				<view class="user-status-time">
					<view class="time">{{props.moment.detail.hits}}人看过</view>
				</view>
			</view>
		</view>
	</view>
	<view class="feed-status-info">
		<view class="user-status-operaters">
			<view catchtap="handleShare" class="operater-item share-btn">
				<image  wx:if="{{props.moment.detail.is_share === 0}}" mode="aspectFill" src="../../../images/icon_share.png"></image>
				<image wx:if="{{props.moment.detail.is_share > 0}}" mode="aspectFill" src="../../../images/icon_share_active.png"></image>
				<text class="count">{{props.moment.detail.share_count}}</text>
			</view>
			<view catchtap="handleShowChat" class="operater-item comment-btn">
				<image mode="aspectFill" src="../../../images/comment_icon.png"></image>
				<text class="count">{{props.moment.detail.comment_count}}</text>
			</view>
			<view class="operater-item agree-btn" data-id="{{props.moment.detail.id}}" data-uid="{{props.moment.detail.uid}}" catchtap="handleAgree">
				<image wx:if="{{props.moment.detail.is_like === 0}}" mode="aspectFill" src="../../../images/icon_zan.png"></image>
				<image wx:if="{{props.moment.detail.is_like > 0}}" mode="aspectFill" src="../../../images/icon_zan_active.png"></image>
				<text class="count">{{props.moment.detail.like_count}}</text>
			</view>
		</view>
		<view wx:if="{{props.moment.detail.reward_as == 1}}" class="reward-tag supply">他提供货源</view>
		<view wx:if="{{props.moment.detail.reward_as == 2}}" class="reward-tag">他在找货源</view>
	</view>

	<view wx:if="{{props.moment.detail.participate_count >= 0 && props.moment.detail.uid != props.user.id && props.moment.detail.statue != '1'}}" class="action-panel">
		<button class="action-btn" catchtap="handleJoin" data-id="{{props.moment.detail.id}}">点击参与</button>
	</view>

	<view class="comments-wrapper">
		<view class="navbar">
			<view id="{{0}}" class="item {{state.activeIndex == 0 ? 'on' : ''}}" bindtap="tabClick">
				<text>评论</text>
				<text>{{props.moment.detail.comment_count}}</text>
			</view>
			<view id="{{1}}" class="item {{state.activeIndex == 1 ? 'on' : ''}}" bindtap="tabClick">
				<text>赞</text>
				<text>{{props.moment.detail.like_count}}</text>
			</view>
			<view id="{{2}}" class="item {{state.activeIndex == 2 ? 'on' : ''}}" bindtap="tabClick">
				<text>分享</text>
				<text>{{props.moment.detail.share_count}}</text>
			</view>
			<view id="{{3}}" class="item {{state.activeIndex == 3 ? 'on' : ''}}" bindtap="tabClick">
				<text>访客</text>
				<text>{{props.moment.detail.hits}}</text>
			</view>
			<view class="weui-navbar__slider" style="left: {{state.sliderLeft}}rpx; transform: translateX({{state.sliderOffset}}px); -webkit-transform: translateX({{state.sliderOffset}}px);"></view>
		</view>
		<view class="content-panel">
			<view class="content" hidden="{{state.activeIndex != 0}}">
				<block wx:for="{{props.moment.detail.comments}}"  wx:key="id">
					<view class="feed-comment-panel" data-id="{{item.id}}" catchtap="handleFocusComment">
						<view class="feed-comment-left">
							<navigator url="../../yaoyue/detail/index?id={{item.created_by}}" class="user-icon-wrapper">
								<image mode="aspectFill" class="user-icon" src="{{item.avatar}}"/>
								<view wx:if="{{item.verify_status == 2}}" class="vip">V</view>
							</navigator>
						</view>
						<view class="feed-comment-right">
							<view class="header">
								<view class="wrapper">
									<text class="user-name">{{item.nickname}}</text>
									<text class="company">{{item.company}}</text>
									<text class="role">{{item.position}}</text>
								</view>
							</view>
							<view class="sub-info">
								<text>{{item.tag_identity_name}}</text>
							</view>
							<view class="user-status-wrapper">
								<view class="user-status-content">
									<view class="words">
										<block wx:if="{{item.to_name !== ''}}">
											<text>回复</text>
											<text class="to-name">{{item.to_name}}</text>
											<text>：</text>
										</block>
										<text>
											<block wx:for-items="{{item.nodes}}" wx:key="{{index}}">
												<template is="content-parse-tmpl" data="{{...item, index: index}}" />
											</block>
										</text>
									</view>
								</view>
							</view>
						</view>
					</view>
					<view class="comment-operaters">
						<view class="operater-item agree-btn" data-id="{{item.id}}" data-uid="{{props.moment.detail.uid}}" catchtap="handleAgreeComment">
							<image wx:if="{{item.is_like === 0}}" mode="aspectFill" src="../../../images/icon_zan.png"></image>
							<image wx:if="{{item.is_like > 0}}" mode="aspectFill" src="../../../images/icon_zan_active.png"></image>
							<text class="count">{{item.like_count}}</text>
						</view>
					</view>
				</block>
			</view>
			<view class="content" hidden="{{state.activeIndex != 1}}">
				<block wx:for="{{props.moment.detail.likes}}"  wx:key="id">
					<template is="user-comment-item" data="{{...item, index: index}}" />
				</block>
			</view>
			<view class="content" hidden="{{state.activeIndex != 2}}">
				<block wx:for="{{props.moment.detail.shares}}"  wx:key="id">
					<template is="user-comment-item" data="{{...item, index: index}}" />
				</block>
			</view>
			<view class="content has-padding" hidden="{{state.activeIndex != 3}}">
				<View wx:if="{{props.moment.detail.wechat != '0' || props.moment.detail.wechat != '0' || props.moment.detail.wechat != '0'}}" class="hits-wrapper">
					<view wx:if="{{props.moment.detail.wechat != '0'}}" class="hits-item">
						<text>微信访客: {{props.moment.detail.wechat}}</text>
					</view>
					<view wx:if="{{props.moment.detail.qq != '0'}}" class="hits-item">
						<text>QQ访客: {{props.moment.detail.qq}}</text>
					</view>
					<view wx:if="{{props.moment.detail.weibo != '0'}}" class="hits-item">
						<text>微博访客: {{props.moment.detail.weibo}}</text>
					</view>
				</View>
				<view class="ali-title">
					<text>健康汇销用户: {{props.moment.detail.app}}</text>
				</view>
				<block wx:for="{{props.moment.detail.app_users}}"  wx:key="id">
					<view class="feed-comment-panel comment-title">
						<view class="feed-comment-left">
							<navigator url="../../yaoyue/detail/index?id={{item.created_by}}" class="user-icon-wrapper">
								<image mode="aspectFill" class="user-icon" src="{{item.avatar}}"/>
								<view wx:if="{{item.verify_status == 2}}" class="vip">V</view>
							</navigator>
						</view>
						<view class="feed-comment-right">
							<view class="header">
								<view class="wrapper">
									<text class="user-name">{{item.nickname}}</text>
									<text class="company">{{item.company}}</text>
									<text class="role">{{item.position}}</text>
								</view>
							</view>
							<view class="sub-info">
								<text>{{item.tag_identity_name}}</text>
							</view>
							<view wx:if="{{item.is_my_friend || item.is_my_friend === 0}}" class="follow-wrapper">
								<block wx:if="{{item.is_my_friend > 0}}">
									<view class="wrapper" data-id="{{item.created_by}}" data-action="cancel">
										<image src="../../../images/icon_follow_status.png" mode="aspectFit"/>
										<text class="has-follow">已关注</text>
									</view>
								</block>
								<block wx:else>
									<view class="wrapper" data-id="{{item.created_by}}" data-action="follow" catchtap="handleFollow">
										<image src="../../../images/icon_follow.png" mode="aspectFit"/>
										<text>加关注</text>
									</view>
								</block>
							</view>
						</view>
					</view>
				</block>
			</view>
		</view>
	</view>

	<view wx:if="{{state.showShareGuide}}" catchtap="handleHideShare">
		<image mode="aspectFill" class="share-guide" src="../../../images/share_guide.png"/>
	</view>
</scroll-view>

<view wx:if="{{state.showChat}}" class="chat-tool">
	<view class="input-wrapper">
		<input cursor-spacing="15" value="{{state.comment.content}}" bindblur="handleBlur" placeholder="输入评论..." bindinput="handleInputValue" bindconfirm="handleSendComment" />
	</view>
	<button type="primary" catchtap="handleSendComment">发送</button>
</view>
